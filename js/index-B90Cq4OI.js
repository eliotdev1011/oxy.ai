import{au as O,aN as C,az as i,aO as z,aP as y,aQ as I,aR as E,aS as j,aT as H,aU as A,M as f,j as M,av as D}from"./index-Dg322SbI.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="23202b5e-beb3-4833-9951-f61da0a4ef81",s._sentryDebugIdIdentifier="sentry-dbid-23202b5e-beb3-4833-9951-f61da0a4ef81")}catch{}})();let b={uniforms:{baseOpacity:{value:1},opacity:{value:0},time:{value:0},pointTexture:{value:null}},vertexShader:[` 
        uniform float time;
        attribute float size;
        varying vec3 vColor;

        float rand (float n) {
        return fract(sin(n)*1000000.);
        }
        void main() {
            vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
            gl_PointSize = size;
            gl_Position = projectionMatrix * mvPosition;
        }`].join(`
`),fragmentShader:[`
        uniform vec3 color;
        uniform sampler2D pointTexture;
        uniform float time;
        uniform float opacity;
        uniform float baseOpacity;
        uniform vec2 mouse;

        void main(){

            // 采样白色纹理
            vec4 texture = texture2D(pointTexture, gl_PointCoord);
            texture.a = baseOpacity*opacity*texture.a;

            vec3 finalColor =  color;
            gl_FragColor = vec4(finalColor,texture.a);
        }
        `].join(`
`)};class R extends O{constructor(t,e,a,n){super(t,e,a,n)}init(){this.arr_wave=[],this.cloudPointCounts=5e3,this.particleSize=0,this.obj_wave=new C,this.generateStat="none",super.init(),this.camera.position.x=0,this.camera.position.y=0,this.camera.position.z=15,i.TweenMax.to(this.camera.position,1.5,{x:0,y:0,z:15,ease:Cubic.easeInOut,onStart:()=>{this.camera_tweening=!0},onComplete:()=>{this.camera_tweening=!1}}),this.startHandler(),this.scene.add(this.obj_wave)}changePointCloud(){this.mesh_particles.material.uniforms.color.value=[0,0,0]}addWave(t,e,a,n){t*=this.sizeScale,e*=this.sizeScale;let l=new z;const w=[],c=[];let u=Math.min(2,window.devicePixelRatio);for(let o=0;o<100;o++){let r=o*2*Math.PI/100,h=0;const _=Math.sin(r)*h,P=Math.cos(r)*h;w.push(_,P,0),c.push(u)}l.setAttribute("position",new y(w,3)),l.setAttribute("size",new y(c,1));let v={pointTexture:{value:new I().load(E)},color:{value:[1,1,1]},opacity:{value:0},baseOpacity:{value:1},time:{value:0}},T=new j({uniforms:v,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader,blending:H,depthTest:!1,transparent:!0}),d=l.getAttribute("size"),m=l.getAttribute("position");d.needsUpdate=!0;let x=new A(l,T);this.obj_wave.add(x),this.arr_wave.push(x);let p=new i.TimelineMax({delay:a,repeat:-1});p.timeScale(.7);let g=this.props.data.waveTime;this.props.data.stopRotate||p.to(x.rotation,g,{z:n*Math.PI/180,ease:Linear.easeNone}),p.to(v.opacity,.5,{value:this.props.data.lightness*.4,ease:Linear.easeNone},.1),p.to(v.opacity,g*.4,{value:0,ease:Linear.easeNone},g*.6);for(let o=0;o<d.array.length;o++){let r={x:0,y:0,size:0,r:t},h=o*2*Math.PI/d.array.length;m.array[o*3+0]=Math.sin(h)*r.r,m.array[o*3+1]=Math.cos(h)*r.r,p.to(r,g,{x:2,y:2,size:12,r:e,ease:Linear.easeNone,onUpdate:()=>{m.array[o*3+0]=Math.sin(h)*r.r,m.array[o*3+1]=Math.cos(h)*r.r,d.array[o]=r.size,m.needsUpdate=!0,d.needsUpdate=!0}},0)}}startHandler(){super.startHandler(this.props.data.tweenInTime),this.changePointCloud()}modelIdxChange(){super.modelIdxChange()}changeGenerateState(t){i.TweenMax.to(this,.5,{particleBGSize:1.2*window.devicePixelRatio}),t=="loading"&&this.generateStat!="loading"?this.generateStat="loading":t=="prepare"&&this.generateStat!="prepare"?(this.generateAnimating=!0,this.generateStat="prepare",i.TweenMax.killTweensOf(this.camera.position),i.TweenMax.killTweensOf(this.mesh_particles.material.uniforms.opacity),i.TweenMax.to(this.camera.position,1,{x:0,y:0,z:.8,ease:Cubic.easeInOut,onComplete:()=>{this.generateAnimating=!1}}),i.TweenMax.to(this.mesh_particles.material.uniforms.opacity,1,{value:0,ease:Cubic.easeInOut}),this.arr_wave.forEach((e,a)=>{e&&(i.TweenMax.killTweensOf(e.material.uniforms.baseOpacity),i.TweenMax.to(e.material.uniforms.baseOpacity,1,{delay:.01*a,value:0,ease:Cubic.easeInOut}))})):t=="none"&&this.generateStat!="none"&&(this.generateAnimating=!0,this.generateStat="none",i.TweenMax.killTweensOf(this.camera.position),i.TweenMax.killTweensOf(this.mesh_particles.material.uniforms.opacity),i.TweenMax.to(this.camera.position,1.1,{x:0,y:0,z:30,ease:Cubic.easeInOut,onComplete:()=>{this.generateAnimating=!1}}),i.TweenMax.to(this.mesh_particles.material.uniforms.opacity,1,{value:1,ease:Cubic.easeInOut}),this.arr_wave.forEach((e,a)=>{e&&(i.TweenMax.killTweensOf(e.material.uniforms.baseOpacity),i.TweenMax.killTweensOf(e.scale),e.material.uniforms.baseOpacity.value=0,i.TweenMax.to(e.material.uniforms.baseOpacity,.7,{delay:.01*a,value:1,ease:Cubic.easeInOut}),e.scale.set(1.3+a*.01,1.3+a*.01,1.3+a*.01),i.TweenMax.to(e.scale,.7,{delay:.01*a,x:1,y:1,z:1,ease:Cubic.easeInOut}))}))}scrollHandler(){this.documentHeight=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight);let t=window.scrollY||window.pageYOffset||document.body.scrollTop+(document.documentElement&&document.documentElement.scrollTop||0);if(this.scrollPercent=t/(this.documentHeight-window.innerHeight),this.scrollPercent=Math.min(1,Math.max(0,this.scrollPercent)),this.generateStat=="none"&&!this.generateAnimating){this.particleBGSize=(1+1*this.scrollPercent)*window.devicePixelRatio;let e=.65,a=(this.scrollPercent-e)/(1-e);this.scrollPercent>e?(this.mesh_particles.material.uniforms.opacity.value=Math.max(1-a,0),this.arr_wave.forEach(n=>{n&&(n.material.uniforms.baseOpacity.value=1-a)})):this.scrollPercent<=e&&(this.mesh_particles.material.uniforms.opacity.value=1,this.arr_wave.forEach(n=>{n&&(n.material.uniforms.baseOpacity.value=1)}))}}onMouseMove(t){let e=this.props.data.mouseMoveDetal;this.camera_tweening?this.controls.setRotateStart(window.innerWidth/2,window.innerHeight/2,e):this.controls.setRotate(t,e)}onWindowResize(t){this.camera.aspect=window.innerWidth/(this.props.data.heightScale*window.innerHeight),this.camera.updateProjectionMatrix(),window.innerWidth/window.innerHeight<3/4?(this.mesh_particles.scale.set(.5,.5,.5),this.cvs.style.touchAction="auto",this.obj_particles.position.set(0,1,0),this.obj_wave.position.set(0,1,0)):(this.mesh_particles.scale.set(.7,.7,.7),this.obj_particles.position.set(0,0,0),this.obj_wave.position.set(0,0,0)),this.renderer.setSize(document.body.clientWidth,document.body.clientHeight*this.props.data.heightScale)}disposeSingle(){}animate(){super.animate()}}const S=f.createContext(void 0),k=()=>{const s=f.useContext(S);if(!s)throw new Error("useSharedState must be used within a SharedStateProvider");return s},W=({children:s})=>{const[t,e]=f.useState("none"),a=n=>{e(n)};return M.jsx(S.Provider,{value:{generateStat:t,updateGenerateStat:a},children:s})},G={data:{hoverEffect:!1,skipModel:!0,stopRotate:!1,tweenInTime:3,mouseMoveDetal:.015,waveTime:5,lightness:1,heightScale:1,useProvider:!1}},B=s=>{const{data:t,modelName:e,showLoading:a,modelIdx:n,style:l,...w}={...G,...s},c=f.useRef(null);let u="none";return t!=null&&t.useProvider&&(u=k().generateStat,f.useEffect(()=>{c.current&&c.current.cvsRef&&c.current.cvsRef.changeGenerateState(u)},[u])),M.jsx(D,{ref:c,data:t,modelName:e,showLoading:a,modelIdx:n,style:l,MainExtend:R,generateStat:u,...w})};export{B as O,W as V,k as u};
